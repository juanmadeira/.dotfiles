#!/bin/bash
# script feito para automatizar a troca de wallpaper e sua sincronização com wallust

DIR="$HOME/.dotfiles/wallpapers"

if command -v nsxiv > /dev/null; then 
    WALL_PATH=$(nsxiv -otfb $DIR)
elif command -v rofi >/dev/null; then
    WALL=$(echo "$(ls $DIR)" | rofi -dmenu -theme "$HOME/.config/rofi/style.rasi" -show-icons)
    WALL_PATH="$DIR/$WALL"
else 
    echo ":: É necessário os pacotes nsxiv ou rofi para selecionar o papel de parede."
fi

if [ -n "$WALL_PATH" ]; then
    WALL_EXT=$(echo $WALL_PATH | sed 's/.*\.\(.*\)/\1/')
    echo "$WALL_PATH"
else
    echo ":: Nenhum papel de parede selecionado. Saindo..."
    exit 0
fi

# swaybg
SWAYBG="$HOME/.config/sway/config.d/monitors.conf"
sed -i '$d' $SWAYBG
echo "output * bg $WALL_PATH fill" >> $SWAYBG
swaymsg reload

# wallust
wallust -s run "$WALL_PATH"
pywalfox update
swaync-client -rs
xrdb -load $HOME/.Xresources

# swaylock
SWAYLOCK="$HOME/.config/swaylock/config"
WALL_SED=$(printf '%s\n' "$WALL_PATH" | sed 's/[\/&]/\\&/g')
sed -i "1s/.*/image=$WALL_SED/" $SWAYLOCK

ps -C spotify > /dev/null
if [ $? = 0 ]; then
    alacritty --app-id confirm ~/.scripts/src/wallustify
    exit
else
    spicetify apply
    exit
fi

